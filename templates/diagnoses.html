{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Справочник диагнозов</h2>


<!-- Добавление нового диагноза -->
<div class="card mb-4">
    <div class="card-header">Добавить диагноз</div>
    <div class="card-body">
        <form method="post" action="/diagnoses/add" class="row g-3">
            <div class="col-md-8">
                <input type="text" name="diagnosis" class="form-control" placeholder="Введите диагноз" required>
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100">Добавить</button>
            </div>
        </form>
    </div>
</div>

<!-- Список диагнозов -->
<div class="list-group">
    {% for d in diagnoses %}
    <div class="list-group-item">

    <div class="d-flex justify-content-between align-items-center">

        <!-- поле — сначала отключено -->
        <input type="text"
               id="diag-input-{{ d.id }}"
               class="form-control me-2 w-75"
               value="{{ d.diagnosis }}"
               disabled>

        <!-- кнопка редактирования -->
        <button class="btn btn-warning me-2"
                onclick="enableEdit({{ d.id }})">
            Редактировать
        </button>

        <!-- кнопка удаления -->
        <a href="/diagnoses/{{ d.id }}/delete"
           class="btn btn-outline-danger">
           Удалить
        </a>
    </div>

    <!-- форма сохранения, скрытая -->
    <form id="diag-form-{{ d.id }}"
          method="post"
          action="/diagnoses/{{ d.id }}/edit"
          class="mt-2"
          style="display:none;">
        <input type="text"
               name="diagnosis"
               class="form-control mb-2"
               id="diag-edit-{{ d.id }}"
               value="{{ d.diagnosis }}" required>

        <button class="btn btn-success">Сохранить</button>
    </form>
</div>
    {% endfor %}
</div>

<script>
function enableEdit(id) {
    // включаем режим редактирования
    document.getElementById("diag-input-" + id).style.display = "none";
    document.getElementById("diag-form-" + id).style.display = "block";

    // переносим текст в форму
    document.getElementById("diag-edit-" + id).value =
        document.getElementById("diag-input-" + id).value;
}
</script>

<!-- Авто-скрытие flash -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const flashBox = document.getElementById("flash-box");
    if (flashBox) {
        setTimeout(() => {
            flashBox.style.transition = "opacity .5s";
            flashBox.style.opacity = "0";
            setTimeout(() => flashBox.remove(), 500);
        }, 2500);
    }
});
</script>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">

    {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page - 1 }}">Назад</a>
      </li>
    {% endif %}

    {% for p in range(1, pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
      </li>
    {% endfor %}

    {% if page < pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page + 1 }}">Вперёд</a>
      </li>
    {% endif %}

  </ul>
</nav>

{% endblock %}