{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Список пациентов</h2>



<!-- Форма добавления -->
<div class="card mb-4">
    <div class="card-header">Добавить пациента</div>
    <div class="card-body">
        <form method="post" action="/patients/add" class="row g-3">

            <div class="col-md-4">
                <label class="form-label">Имя</label>
                <input type="text" name="first_name"
                       class="form-control"
                       required
                       value="{{ saved_first if saved_first else '' }}">
            </div>

            <div class="col-md-4">
                <label class="form-label">Фамилия</label>
                <input type="text" name="last_name"
                    class="form-control"
                    required
                    value="{{ saved_last if saved_last else '' }}">
            </div>

            <!-- date picker (предпочтительный) -->
            <div class="col-md-4">
                <label class="form-label">Дата рождения (полностью)</label>
                <input type="text"
                       name="birth_year"
                       id="birth_year"
                       class="form-control"
                       placeholder="ДД.ММ.ГГГГ"
                       maxlength="10"
                       value="{{ saved_birth if saved_birth else '' }}">
            </div>

            <div class="col-12">
                <button class="btn btn-primary">Добавить</button>
            </div>
        </form>
    </div>
</div>

<script>
document.getElementById("birth_year").addEventListener("input", function(e) {
    let v = this.value.replace(/\D/g, "");   // убрать всё, кроме цифр

    if (v.length > 8) v = v.slice(0, 8);     // максимум 8 цифр

    // вставляем точки автоматически: 12.12.1999
    if (v.length >= 5)
        this.value = v.slice(0,2) + "." + v.slice(2,4) + "." + v.slice(4);
    else if (v.length >= 3)
        this.value = v.slice(0,2) + "." + v.slice(2);
    else
        this.value = v;
});
</script>

<!-- Таблица -->
<table class="table table-striped table-hover">
    <thead class="table-primary">
        <tr>
            <th>ID</th>
            <th>ФИО</th>
            <th>Дата рождения</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for p in patients %}
        <tr>
            <td>{{ p.id }}</td>
            <td>{{ p.name }} {{ p.last_name }}</td>
            <td>{{ p.birth_date }}</td>
            <td class="text-end">
                <a href="/patients/{{ p.id }}" class="btn btn-sm btn-outline-primary">Открыть</a>
                <a href="/patients/{{ p.id }}/delete" class="btn btn-sm btn-outline-danger">Удалить</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Пагинация -->
<nav>
  <ul class="pagination">

    {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page - 1 }}">Назад</a>
      </li>
    {% endif %}

    {% for p in range(1, pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
      </li>
    {% endfor %}

    {% if page < pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page + 1 }}">Вперёд</a>
      </li>
    {% endif %}

  </ul>
</nav>

{% endblock %}